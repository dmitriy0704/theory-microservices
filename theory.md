# Основы микросервисов

## Характеристики

- функциональная декомпозиция или предметно-ориентированное проектирование,
- четко определенные интерфейсы,
- явно публикуемый интерфейс,
- принцип единственной обязанности
- потенциальная многоязычность.

## Двенадцать факторов

1. Кодовая база.  
   Одна кодовая база, отслеживаемая в системе контроля версий, – множество
   развёртываний
2. Зависимости.   
   Явно объявляйте и изолируйте зависимости
3. Конфигурация  
   Сохраняйте конфигурацию в среде выполнения
4. Сторонние службы (Backing Services)   
   Считайте сторонние службы (backing services) подключаемыми ресурсами
5. Сборка, релиз, выполнение  
   Строго разделяйте стадии сборки и выполнения
6. Процессы  
   Запускайте приложение как один или несколько процессов не сохраняющих
   внутреннее состояние (stateless)
7. Привязка портов (Port binding)  
   Экспортируйте сервисы через привязку портов
8. Параллелизм  
   Масштабируйте приложение с помощью процессов
9. Утилизируемость (Disposability)  
   Максимизируйте надёжность с помощью быстрого запуска и корректного завершения
   работы
10. Паритет разработки/работы приложения.  
    Держите окружения разработки, промежуточного развёртывания (staging) и
    рабочего развёртывания (production) максимально похожими
11. Журналирование (Logs)  
    Рассматривайте журнал как поток событий
12. Задачи администрирования.  
    Выполняйте задачи администрирования/управления с помощью разовых процессов

Сложности работы с микросервисами

- Управление. Микросервисная архитектура предполагает работу с большим
  количеством сервисов, каждый из которых имеет собственную версию и набор
  зависимостей.
- Комплексность взаимодействия. Микросервисы взаимодействуют друг с другом
  посредством сетевых запросов. Это может привести к проблемам с
  производительностью и надежностью, так как каждый сетевой запрос может стать
  точкой отказа.
- Обеспечение целостности данных. При использовании микросервисной архитектуры
  данные могут храниться и обрабатываться разными сервисами. Обеспечение
  целостности данных и синхронизация между сервисами может быть сложной задачей.
  Например, в финтехе или других сферах, завязанных на быстродействие системы,
  синхронизировать тысячи транзакций — действительно непростая задача.
- Сложность отладки и тестирования. В микросервисной архитектуре каждый сервис
  может быть разработан, развернут и масштабирован независимо. Это может
  затруднять процесс отладки и тестирования, так как необходимо изолировать
  проблему до конкретного сервиса.
- Уязвимости безопасности. Поскольку каждый сервис имеет доступ к части данных,
  уязвимость в одном сервисе может привести к компрометации всей системы.
- Необходимо учитывать эти риски при проектировании и разработке микросервисной
  архитектуры, чтобы минимизировать их влияние на систему

## Когда следует использовать микросервисы?

# Сервис-ориентированная архитектура (SOA)


# Архитектура микросервисов

## Особенности микросервисной архитектуры

Ключевые особенности микросервисной архитектуры:

- Масштабируемость. Микросервисы могут быть масштабированы независимо друг от
  друга. Это позволяет распределять нагрузку и ресурсы по сервисам, которые
  нуждаются в поддержке прямо сейчас.
- Независимость. Каждый сервис полностью автономен и не затрагивает работу
  соседей. Это означает, что каждый сервис может быть разработан, развернут и
  обновлен отдельно, без воздействия на остальные компоненты.
- Легковесность. Микросервисы используют легковесные протоколы для
  взаимодействия между собой, такие как REST или gRPC. Это позволяет сервисам
  быстро обмениваться данными.
- Гибкость. Микросервисы могут быть разработаны с использованием разных
  технологий и языков программирования. Это дает разработчикам большую гибкость
  при выборе технологий для конкретных компонентов системы. Это также позволяет
  эффективнее управлять командой разработки.
- Управление ошибками. У каждого сервиса есть свое собственное управление
  ошибками и восстановлением после сбоев. Если один сервис не отвечает, это не
  приводит к полной остановке системы. Например, сайт продолжит принимать
  покупки, если микросервис, отвечающий за логистику, будет какое-то время
  недоступен.
- Легкость развертывания. Микросервисы могут быть легко развернуты на различных
  серверах или облачных платформах.
- Распределенная разработка. При построении микросервисной архитектуры
  разработка приложения может быть распределена между несколькими командами.
  Каждая команда может работать над отдельным сервисом, что ускоряет разработку.
- Легкая замена. Если требуется заменить один сервис, его можно легко заменить,
  не затрагивая другие сервисы. Это упрощает обновление системы и добавление
  новых функций.

## Преимущества микросервисной архитектуры

Преимущества микросервисов оказались достаточно сильны, чтобы такие крупные
корпоративные игроки как Amazon, Netflix или eBay внедрили их в свои системы.

- Высокая отказоустойчивость: при падении одного из сервисов, все остальные
  остаются в строю. Таким образом, неполадки в отдельных сервисах не помешают
  всему рабочему процессу;
- Гибкость: можно попробовать внедрить новую технологию малой кровью. Это будет
  значительно быстрее и, при неудаче, откатить изменения просто. Меняя локально
  один из сервисов, мы не рискуем всей системой и время, требующееся для
  изменений, меньше;
- Простота: чем меньше кода (а каждый отдельный сервис представляет собой
  цельную систему, поэтому не нужно разбираться в огромном количестве деталей,
  не касающихся данной конкретной функции), тем проще программистам разобраться,
  что и как работает. К тому же, на это уйдет меньше времени;
- Лёгкость выведения написанного кода в работу: небольшое количество кода
  обеспечивает быстрый деплой;
- Масштабируемость: самые необходимые и нужные сервисы можно дополнить и
  расширить, когда появится такая необходимость. Вся система при этом остается
  прежней.

По сравнению с монолитной, микросервисная архитектура обладают большей гибкостью
и возможностью независимого масштабирования отдельных сервисов. Проще вносить
локальные изменения в код без риска для всей системы, но взамен этого возрастает
сложность взаимодействия между сервисами.

## Недостатки микросервисной архитектуры

Несмотря на трендовость и большое количество плюсов микросервисной архитектуры,
она обладает и минусами.

- Сообщение между самими сервисами сложное. Так как каждый функциональный
  элемент изолирован, требуется особая тщательность при построении между ними
  грамотной коммуникации, ведь им в любом случае придётся обмениваться запросами
  и ответами друг с другом. Понятно, что с увеличением количества сервисов
  сложность в построении их сообщения будет расти.
- Рост числа сервисов также влечет за собой и рост числа баз данных, с которыми
  эти сервисы соотносятся, так как, в отличие от монолитной архитектуры,
  микросервисы используют не одну общую базу данных.
- Сложность тестирования выражается в том, что сначала нужно отдельно
  разбираться с каждым сервисом, а потом тестировать корректное взаимодействие
  его с другими микросервисами.
- Микросервисы хуже подходят для использования внутри отдельных организаций, для
  них они могут оказаться неоправданно сложными в применении, в то время как для
  массовых интернет-сервисов они подходят отлично.

## Сравнение микросервисной архитектуры и монолитной

| Параметры                            | Монолитная архитектура                                                                                                                       | Микросервисная архитектура                                                                                                                                                                                                                                                          |
|--------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Размер и сложность                   | Монолитная архитектура представляет собой одно большое приложение, в котором все компоненты связаны друг с другом напрямую                   | В микросервисной архитектуре приложение разбивается на множество микросервисов, каждый из которых отвечает за конкретную функциональность. Это позволяет разделить сложное приложение на более простые и независимые части                                                          |
| Гибкость и масштабируемость          | В монолитной архитектуре, изменения и масштабирование требуют работы со всем приложением, что может быть неэффективным и сложным             | Микросервисная архитектура дает большую гибкость при разработке и поддержке приложения. Каждый микросервис может быть разработан, протестирован и развернут независимо от других. Это также облегчает масштабирование, поскольку можно масштабировать только необходимые компоненты |
| Надежность                           | В монолитной архитектуре, если одна часть приложения отказывает, это может привести к отказу всего приложения                                | В микросервисной архитектуре, если один микросервис перестает работать, остальные микросервисы продолжают функционировать независимо                                                                                                                                                |
| Сложность развертывания и управления | Монолитная архитектура может быть более простой в развертывании и управлении, поскольку ее элементы не связаны сложной системой зависимостей | Управление микросервисной архитектурой может быть сложнее, так как требуется управлять несколькими независимыми сервисами и их взаимодействием                                                                                                                                      |

## Сравнение преимуществ микросервисной архитектуры и монолитной

| Монолит                                                                                                                                                                                                                                                                                        | Микросервисная архитектура                                                                                                                                                                                                                    |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Простота <br/><br/>Монолитная архитектура гораздо проще в реализации, управлении и развёртывании. <br/><br/>Микросервисы требуют тщательного управления, поскольку они развёртываются на разных серверах и используют API.                                                                     | Частичное развёртывание<br/><br/>Микросервисы позволяют по мере необходимости обновлять приложение по частям.<br/><br/> При единой архитектуре нам приходится заново развёртывать приложение целиком, что влечёт за собой куда больше рисков. |
| Согласованность (Consistency) <br/><br/>  При монолитной архитектуре проще поддерживать согласованность кода, обрабатывать ошибки и т. д. Зато микросервисы могут полностью управляться разными командами с соблюдением разных стандартов                                                      | Доступность<br/><br/>  У микросервисов доступность выше: даже если один из них сбоит, это не приводит к сбою всего приложения.                                                                                                                |
| Межмодульный рефакторинг <br/><br/> Единая архитектура облегчает работу в ситуациях, когда несколько модулей должны взаимодействовать между собой или когда мы хотим переместить классы из одного модуля в другой. В случае с микросервисами мы должны очень чётко определять границы модулей! | Сохранение модульности<br/><br/> Сохранять модульность и инкапсуляцию может быть непросто, несмотря на правила SOLID. Однако микросервисы позволяют гарантировать отсутствие общих состояний (shared state) между модулями.                   |
|                                                                                                                                                                                                                                                                                                | Мультиплатформенность/гетерогенность <br/><br/> Микросервисы позволяют использовать разные технологии и языки, в соответствии с вашими задачами.                                                                                              |
